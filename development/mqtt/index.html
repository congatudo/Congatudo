
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../congatudo-core-concepts/">
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>MQTT - </title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mqtt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="../../img/congatudo_logo_with_name.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MQTT
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/congatudo/Congatudo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="../../img/congatudo_logo_with_name.svg" alt="logo">

    </a>
    
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/congatudo/Congatudo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    General
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            General
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/why-congatudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Congatudo?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/congatudo-or-valetudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congatudo or Valetudo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/supported-robots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supported Robots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/buying-supported-robots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Buying supported robots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/donate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Donate to the project
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/robot-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Robot setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/home-assistant-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home Assistant installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/docker-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/standalone-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Standalone installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/capabilities-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capabilities Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Companion Apps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Companion Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/valetudo_companion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Valetudo Companion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/valetudo_tray_companion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Valetudo Tray Companion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/valeronoi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Valeronoi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/lovelace_valetudo_map_card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lovelace Valetudo Map Card
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/i_cant_believe_its_not_valetudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    I can't believe it's not Valetudo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/node-red-contrib-valetudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    node-red-contrib-valetudo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../companion_apps/fun_games/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fun & Games
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/mqtt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MQTT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/home-assistant-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home Assistant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/node-red/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node-RED
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/openhab-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    openHAB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/important-files-and-folders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Important Files & Folders
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/empower-your-conga-voice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Empower your Conga voice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/map-segments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map Segments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/add-ssh-key/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add SSH Key
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/hey-google-clean-my-room/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hey Google Clean My Room
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/get-area-and-time-in-ha-from-congatudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get area and time in Home Assistant from Congatudo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/clean-me/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clean me
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/time-and-tank-virtual-sensors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time and Tank Virtual Sensors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/recovery-root-password/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recovery root password
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/change-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Change schedule
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building-and-modifying-congatudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Modifying Congatudo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../congatudo-core-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congatudo core concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    MQTT
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    MQTT
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Main concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Responsibilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handles" class="md-nav__link">
    <span class="md-ellipsis">
      Handles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handle-tree-and-data-publication" class="md-nav__link">
    <span class="md-ellipsis">
      Handle tree and data publication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-robot-handle" class="md-nav__link">
    <span class="md-ellipsis">
      The robot handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-state-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The state handles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-capability-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The capability handles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-property-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The property handles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#home-assistant-components" class="md-nav__link">
    <span class="md-ellipsis">
      Home Assistant components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Home Assistant components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-and-the-handle-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Components and the handle tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-topics-and-data-through-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      Sharing topics and data through anchors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-and-donts" class="md-nav__link">
    <span class="md-ellipsis">
      Dos and don'ts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-statuscapability-handle-does-not-get-published" class="md-nav__link">
    <span class="md-ellipsis">
      A status/capability handle does not get published
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anchors-are-not-updating-but-handles-are" class="md-nav__link">
    <span class="md-ellipsis">
      Anchors are not updating but handles are
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Main concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Responsibilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handles" class="md-nav__link">
    <span class="md-ellipsis">
      Handles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handle-tree-and-data-publication" class="md-nav__link">
    <span class="md-ellipsis">
      Handle tree and data publication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-robot-handle" class="md-nav__link">
    <span class="md-ellipsis">
      The robot handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-state-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The state handles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-capability-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The capability handles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-property-handles" class="md-nav__link">
    <span class="md-ellipsis">
      The property handles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#home-assistant-components" class="md-nav__link">
    <span class="md-ellipsis">
      Home Assistant components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Home Assistant components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-and-the-handle-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Components and the handle tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-topics-and-data-through-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      Sharing topics and data through anchors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-and-donts" class="md-nav__link">
    <span class="md-ellipsis">
      Dos and don'ts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-statuscapability-handle-does-not-get-published" class="md-nav__link">
    <span class="md-ellipsis">
      A status/capability handle does not get published
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anchors-are-not-updating-but-handles-are" class="md-nav__link">
    <span class="md-ellipsis">
      Anchors are not updating but handles are
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mqtt">MQTT</h1>
<p>Congatudo supports publishing status data and receiving commands from MQTT.</p>
<p>The following autodiscovery protocols are supported:</p>
<ul>
<li>Home Assistant</li>
<li>Homie</li>
</ul>
<p>They are both optional and mutually compatible: you can enable both at the same time or none at all.</p>
<h2 id="main-concepts">Main concepts</h2>
<p>Since the MQTT code is heavily based on the capabilities system you may want to first give a look to how capabilities,
status attributes, and the robot object work.</p>
<p>The MQTT OOP structure is heavily influenced by the Homie convention. This page will also contain lots of references to
it, so make sure you grasp the fundamental concepts of the convention before proceeding further:</p>
<ul>
<li>Overview: <a href="https://homieiot.github.io/">https://homieiot.github.io/</a></li>
<li>Specification: <a href="https://homieiot.github.io/specification/spec-core-v4_0_0/">https://homieiot.github.io/specification/spec-core-v4_0_0/</a></li>
</ul>
<h3 id="responsibilities">Responsibilities</h3>
<p>To keep the codebase maintainable and prevent entire classes of potential issues, the code tries to define and restrict
the responsibilities of each component as follows:</p>
<ul>
<li><code>MqttHandle</code> and subclasses<ul>
<li>Provide infrastructure to receive events from status attributes and send commands to capabilities</li>
<li>Manage Homie attributes</li>
<li>Parse and validate incoming and outgoing payloads</li>
</ul>
</li>
<li><code>HassComponent</code> and subclasses<ul>
<li>Provide infrastructure to allow sharing as much data as possible with <code>MqttHandle</code>s</li>
<li>Manage Hass autoconfiguration payloads</li>
</ul>
</li>
<li><code>MqttController</code><ul>
<li>Handle the MQTT configuration</li>
<li>Handle all aspects of the MQTT communication, such as connection, disconnection, publication, subscriptions</li>
<li>Enforce a well-defined procedure for Homie state changes and reconfiguration</li>
<li>Handle and dispatch events that can't be handled by handles directly</li>
</ul>
</li>
<li><code>HassController</code><ul>
<li>Act as a middleware between <code>MqttController</code> and <code>HassComponent</code>s</li>
</ul>
</li>
</ul>
<h3 id="handles">Handles</h3>
<p>Handles are subclasses of <code>MqttHandle</code>. They are designed to map exactly to the levels of the Homie convention topology.
Specifically:</p>
<ul>
<li><code>RobotMqttHandle</code> ⇒ Homie device</li>
<li><code>NodeMqttHandle</code> ⇒ Homie node</li>
<li><code>PropertyMqttHandle</code> ⇒ Homie property</li>
</ul>
<p>Two more classes are present that further extend from these and bridge the handles to Congatudo's internals:</p>
<ul>
<li><code>RobotStateNodeMqttHandle</code> maps to <code>StatusStateAttribute</code></li>
<li><code>CapabilityMqttHandle</code> maps to <code>Capability</code></li>
<li>(<code>RobotMqttHandle</code> maps to <code>CecotecCongaRobot</code>)</li>
</ul>
<h4 id="handle-tree-and-data-publication">Handle tree and data publication</h4>
<p>Handles are assigned into a tree structure:</p>
<ul>
<li><code>RobotMqttHandle</code>, being the root handle, registers to the <code>MqttController</code></li>
<li><code>NodeMqttHandle</code>s register to <code>RobotMqttHandle</code></li>
<li><code>PropertyMqttHandle</code>s register to <code>NodeMqttHandle</code></li>
</ul>
<p>This structure simplifies and unifies publication to the MQTT broker, Instead of publishing data directly, any handle
may "refresh" itself.</p>
<p>When a handle is refreshed it will ask the <code>MqttController</code> to retrieve a fresh payload from it and publish it to its
designated topic.</p>
<p>Refreshing is recursive: whenever a handle is refreshed all children are refreshed as well. Attached Home Assistant
components will also be refreshed, but we will discuss this later.</p>
<h4 id="the-robot-handle">The robot handle</h4>
<p><code>RobotMqttHandle</code> is special since it is the root handle. It maps to a Homie device. It is mainly responsible for
checking which capabilities the robot supports and registering the corresponding handles.</p>
<p>It will also subscribe to the robot status and register matching handles <strong>as soon as the corresponding attributes are
added</strong> (therefore it's normal if they don't show up until the robot is fully connected and the status is polled).</p>
<p>Finally, it handles the registration of <code>MapNodeMqttHandle</code>, which as the name suggests provides map data.</p>
<h4 id="the-state-handles">The state handles</h4>
<p><code>RobotStateNodeMqttHandle</code> children all map to Homie nodes. Their peculiarity is that they provide infrastructure to
subscribe to the robot state.</p>
<p>This is accomplished by providing a list of status attribute matchers, which the handle will subscribe to.</p>
<p>When a status event occurs, the handle and all its children are refreshed.</p>
<h4 id="the-capability-handles">The capability handles</h4>
<p><code>CapabilityMqttHAndle</code> children also map to Homie nodes. The class itself inherits from <code>RobotStateNodeMqttHandle</code>,
therefore it is as well able to subscribe to robot status events.</p>
<p>It is encouraged, whenever possible, to handle status data in a capability handle as opposed to a status handle whenever
actions performed on the capability will be reflected into and match exactly to a status attribute event.</p>
<p>This is true, for example, for both <code>PresetSelectionCapability</code>s, since setting a preset will usually result in the same
value being reflected back to the status attribute: you send <code>low</code> and you get back <code>low</code>.</p>
<p>This is NOT true, for example, for <code>BasicControlCapability</code>. While actions performed on it will directly affect
<code>StatusStateAttribute</code>, the status event won't match exactly: you perform <code>START</code> but you get back <code>CLEANING</code>.</p>
<h4 id="the-property-handles">The property handles</h4>
<p><code>PropertyMqttHandle</code>, as the name suggests, maps to Homie properties. However, unlike the previously discussed handles,
property handles do not have subclasses and should not be subclassed.</p>
<p>Property handles are in fact defined and registered in-line in the capability/status handle constructors. All data is
provided as parameters to the constructor.</p>
<p>These handles handle the actual data to be published and receive commands. However, they never interact directly with
the MQTT client. They instead must be provided with at least one of the following callbacks: a <code>getter</code> to retrieve
fresh data to be published; a <code>setter</code> to perform operations with the data received from MQTT.</p>
<p>When a <code>setter</code> callback is provided, property handles will be subscribed to a <code>/set</code> topic.</p>
<p>When a <code>setter</code> is provided but a <code>getter</code> is not provided, the property will act as a <em>command property</em> according to
the Homie convention: the data received in the <code>/set</code> topic will automatically be reflected back to the main topic to
acknowledge the command.</p>
<h3 id="home-assistant-components">Home Assistant components</h3>
<p>Home Assistant uses a very different workflow. Instead of defining a structure, it defines components which may or may
not map to some capabilities' behavior.</p>
<p>In some instances it will try to adapt to an existing MQTT structure and allow you to provide topics and payloads for
accomplishing different tasks. In some other cases it will try to impose its own structure.</p>
<p>This makes it difficult to share data with the previously defined structure. However, Congatudo provides enough
abstraction to make this easier: <code>HassComponent</code>.</p>
<p>Home Assistant components may subscribe to topics. However, this should be avoided when possible: most features can and
should be implemented by providing Hass with the handle topics.</p>
<h4 id="components-and-the-handle-tree">Components and the handle tree</h4>
<p>Components are not handles, they are a separate entity. However, in order to share data with handles, they are attached
to and managed by the handle they share information with.</p>
<p>Components may be attached to any type of handle, from the robot handle to the property handle. For instance, the map
component is attached to the map handle.</p>
<p>Whenever an handle is refreshed, the attached Hass components are refreshed as well.</p>
<h4 id="sharing-topics-and-data-through-anchors">Sharing topics and data through anchors</h4>
<p>Some components are trickier. For example, the <code>VacuumHassComponent</code> is attached to the robot handle since that's what
it shares most data with. However, it also needs access to the fan speed and a reference to the <code>BasicControlCapability</code>
command topic in order to send cleaning control commands.</p>
<p>This is accomplished using <code>HassAnchor</code>.</p>
<p><code>HassAnchor</code> is a utility to share data from the handle that manages some type of information to the hass component that
needs it.</p>
<p>There are two types of <code>HassAnchor</code>: plain anchors and topic references. The implementation is exactly the same, the
distinction has been put in place, once again, to separate responsibilities: "plain" anchors may only be used in
payloads, topic references may only be used in autoconfiguration payloads.</p>
<p><code>HassAnchor</code>s can be thought of as fancy "template variables". Hass component payloads are in fact provided as regular
JavaScript objects. For any value that is not immediately available, an <code>HassAnchor</code> may be retrieved and used in its
place.</p>
<p>Of course, the value isn't going to jump into existence on its own: some other component needs to provide it. This is a
responsibility of handles: whenever they share some value with a hass component, they should also <code>post()</code> it into the
anchor every time they retrieve it for their own needs.</p>
<p><code>HassAnchor</code>s are eventful: whenever a handle posts a value into an anchor, the hass component that uses it is
automatically refreshed and its payload published to MQTT.</p>
<p>If for whatever reason an anchor doesn't hold any value when the hass component payload is requested for publication,
the publication will be delayed. This means that <strong>you should only use anchors if you are sure they will be populated</strong>,
otherwise the hass component will stay in a limbo forever.</p>
<h2 id="dos-and-donts">Dos and don'ts</h2>
<p>Here's a bunch of things to keep in mind when adding new MQTT handles and Home Assistant components.</p>
<ul>
<li><strong>Don't</strong> try to bypass the API restrictions: if you find it hard to get something done you're probably not doing it
  correctly</li>
<li><strong>Do</strong> suggest and discuss API changes that accommodate your use case</li>
</ul>
<hr />
<ul>
<li><strong>Don't</strong> implement something only for Homie or for Home Assistant</li>
<li><strong>Do</strong> take your time and do things properly</li>
</ul>
<hr />
<ul>
<li><strong>Don't</strong> abuse <code>HassAnchor</code></li>
<li><strong>Do</strong> try to define your hass component close to its handle, so that most data you need will be in the same scope</li>
</ul>
<hr />
<ul>
<li><strong>Don't</strong> link Home Assistant fields to Homie <code>$attributes</code> - they won't be available if Homie is disabled</li>
<li><strong>Do</strong> define a payload for the Home Assistant component with all the data you need, using anchors if needed</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>This section does not describe general MQTT troubleshooting, but rather troubleshooting of problems that can occur when
writing new code.</p>
<h3 id="a-statuscapability-handle-does-not-get-published">A status/capability handle does not get published</h3>
<p>Status handles are only published once the <code>StatusAttribute</code> they subscribe to first appears. If it does appear, but the
handle isn't published, you may have an incorrect attribute matcher.</p>
<p>Both status and capability handles have to be registered into the designated lists inside the <code>HandleMappings.js</code> file
for them to be loaded.</p>
<h3 id="anchors-are-not-updating-but-handles-are">Anchors are not updating but handles are</h3>
<p>You can enable <code>debug.debugHassAnchors</code> in the configuration and set the log level to <code>trace</code>. It will print a report
whenever an anchor is blocking publication for a Hass component.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>